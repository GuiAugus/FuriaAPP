@page "/login"
@using FuriaAPP.Shared.DTOs.Usuario
@inject HttpClient Http
@inject NavigationManager Navigation

<h3 class="text-xl font-semibold mb-4">Login</h3>

@if (!string.IsNullOrEmpty(errorMessage))
{
    <div class="text-red-600 mb-2">@errorMessage</div>
}

<EditForm Model="loginDto" OnValidSubmit="HandleLogin">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="mb-3">
        <label>Email:</label>
        <InputText class="border rounded p-2 w-full" @bind-Value="loginDto.Email" />
    </div>

    <div class="mb-3">
        <label>Senha:</label>
        <InputText class="border rounded p-2 w-full" @bind-Value="loginDto.Senha" type="password" />
    </div>

    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Entrar</button>
</EditForm>

@code {
    private UsuarioLoginDto loginDto = new();
    private string? errorMessage;

    private async Task HandleLogin()
    {
        try
        {
            var response = await Http.PostAsJsonAsync("api/Usuario/login", loginDto);
            if (response.IsSuccessStatusCode)
            {
                Navigation.NavigateTo("/");
            }
            else
            {
                errorMessage = "Login inv√°lido. Verifique seus dados.";
            }
        }
        catch (Exception)
        {
            errorMessage = "Erro ao tentar logar.";
        }
    }
}
